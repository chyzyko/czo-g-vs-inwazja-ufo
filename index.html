<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Czo≈Çg kontra UFO</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
    }
    #menu, #gameover {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2;
      color: white;
      text-shadow: 2px 2px #000;
      animation: fadeIn 1s ease-in-out;
    }
    #menu {
      background: radial-gradient(ellipse at center, #000022 0%, #000000 100%);
      background-image: url("https://www.transparenttextures.com/patterns/stardust.png");
    }
    #gameover {
      background: linear-gradient(to bottom, #001f3f, #0074D9);
    }
    #menu h1 {
      font-size: 3em;
      margin-bottom: 10px;
    }
    #menu .description {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #4CAF50;
      margin: 20px;
      max-width: 600px;
      text-align: center;
    }
    #menu p, .description p {
      font-size: 1.3em;
      margin: 10px 0;
    }
    button, select, input[type="color"], input[type="range"] {
      font-size: 18px;
      padding: 8px 16px;
      margin: 10px;
      border: none;
      border-radius: 10px;
    }
    button {
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background: #888;
      cursor: not-allowed;
    }
    button:hover:enabled {
      background: #388E3C;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>üöÄ Czo≈Çg kontra UFO</h1>
    <div class="description">
      <p><strong>Sterowanie:</strong></p>
      <p>üñ±Ô∏è Przesu≈Ñ myszkƒÖ lub palcem, aby poruszaƒá czo≈Çgiem</p>
      <p>üëÜ Kliknij lub stuknij, aby strzelaƒá</p>
    </div>

    <p>Wybierz tryb gry:</p>
    <select id="themeSelect" onchange="checkOptionsSelected()">
      <option value="">-- wybierz --</option>
      <option value="day">Dzie≈Ñ</option>
      <option value="night">Noc</option>
    </select>

    <p>Kolor czo≈Çgu:</p>
    <input type="color" id="tankColor" onchange="checkOptionsSelected()">

    <p>D≈Çugo≈õƒá lufy:</p>
    <input type="range" id="barrelLength" min="10" max="60" oninput="checkOptionsSelected()">

    <div id="difficultyButtons">
      <p>Wybierz poziom trudno≈õci:</p>
      <button onclick="startGame('easy')" disabled>≈Åatwy</button>
      <button onclick="startGame('medium')" disabled>≈öredni</button>
      <button onclick="startGame('hard')" disabled>Trudny</button>
    </div>
  </div>

  <div id="gameover" style="display:none;">
    <h1>Przegrana!</h1>
    <p id="finalScore"></p>
    <p id="bestScore"></p>
    <button onclick="restart()">Zagraj ponownie</button>
  </div>

  <canvas id="game"></canvas>

  <audio id="shootSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_06dd9d8c81.mp3" preload="auto"></audio>
  <audio id="explosionSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_975798db15.mp3" preload="auto"></audio>
  <audio id="hitSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_88e99e1b7a.mp3" preload="auto"></audio>
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2023/03/27/audio_593fed689f.mp3" preload="auto" loop></audio>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;
    window.addEventListener("resize", () => {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    });

    const shootSound = document.getElementById("shootSound");
    const explosionSound = document.getElementById("explosionSound");
    const hitSound = document.getElementById("hitSound");
    const bgMusic = document.getElementById("bgMusic");
    bgMusic.volume = 0.1;

    let tank, bullets, ufos, ufoBullets, explosions, score, hp, gameOver, ufoSpeed, gameStarted, level;
    let ufoInterval, shootInterval, theme = 'day', tankColor = '#008000', barrelLength = 20;

    function resetGameVars() {
      tank = { x: w / 2, y: h - 60 };
      bullets = []; ufos = []; ufoBullets = []; explosions = [];
      score = 0; hp = 3; gameOver = false;
    }

    function checkOptionsSelected() {
      const themeSel = document.getElementById("themeSelect").value;
      const colorSel = document.getElementById("tankColor").value;
      const barrelSel = document.getElementById("barrelLength").value;
      const allSet = themeSel && colorSel && barrelSel;
      document.querySelectorAll("#difficultyButtons button").forEach(btn => btn.disabled = !allSet);
    }

    function drawBackground() {
      ctx.fillStyle = theme === 'day' ? '#87CEEB' : '#0a0a2a';
      ctx.fillRect(0, 0, w, h);
      ctx.beginPath();
      ctx.arc(w - 100, 100, 50, 0, Math.PI * 2);
      ctx.fillStyle = theme === 'day' ? 'yellow' : '#ccc';
      ctx.fill();

      ctx.fillStyle = 'white';
      if (theme === 'day') {
        for (let i = 0; i < w; i += 200) {
          ctx.beginPath();
          ctx.arc(i + 50, 100, 30, 0, Math.PI * 2);
          ctx.arc(i + 80, 90, 40, 0, Math.PI * 2);
          ctx.arc(i + 120, 100, 30, 0, Math.PI * 2);
          ctx.fill();
        }
      } else {
        for (let i = 0; i < 200; i++) {
          ctx.fillRect(Math.random() * w, Math.random() * h, 1.5, 1.5);
        }
      }

      ctx.fillStyle = '#2E8B57';
      ctx.fillRect(0, h - 80, w, 80);
      ctx.fillStyle = '#8B4513';
      for (let i = 0; i < w; i += 100) {
        ctx.beginPath();
        ctx.moveTo(i, h - 80);
        ctx.lineTo(i + 50, h - 250); // wy≈ºsze g√≥ry
        ctx.lineTo(i + 100, h - 80);
        ctx.closePath();
        ctx.fill();
      }
    }

    function drawTank() {
      ctx.fillStyle = tankColor;
      ctx.fillRect(tank.x - 25, tank.y, 50, 20);
      ctx.fillStyle = 'black';
      ctx.fillRect(tank.x - 30, tank.y + 15, 60, 5);
      ctx.fillStyle = 'darkgray';
      ctx.fillRect(tank.x - 3, tank.y - barrelLength, 6, barrelLength);
      ctx.beginPath();
      ctx.arc(tank.x, tank.y + 10, 10, 0, Math.PI * 2);
      ctx.fillStyle = 'gray';
      ctx.fill();
    }

    function drawUfo(u) {
      ctx.fillStyle = u.type === 'fast' ? '#00ffff' : u.type === 'strong' ? '#aa0000' : 'silver';
      ctx.beginPath();
      ctx.ellipse(u.x, u.y, 30, 15, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'purple';
      ctx.beginPath();
      ctx.arc(u.x, u.y - 10, 10, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawBullet(b, color = 'white') {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawExplosion(e) {
      ctx.fillStyle = 'orange';
      ctx.beginPath();
      ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawHUD() {
      ctx.fillStyle = 'black';
      ctx.font = '20px Arial';
      ctx.fillText(`Wynik: ${score}`, 20, 30);
      ctx.fillStyle = '#ff3333';
      ctx.fillText(`HP: ${'‚ù§'.repeat(hp)}`, 20, 60);
    }

    function collision(a, b, r) {
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return Math.sqrt(dx * dx + dy * dy) < r;
    }

    function spawnUfo() {
      const t = Math.random();
      let type = 'normal';
      if (t < 0.2) type = 'fast';
      else if (t < 0.4) type = 'strong';
      ufos.push({ x: Math.random() * (w - 60) + 30, y: 30, dx: (Math.random() - 0.5) * 2, type, hp: type === 'strong' ? 2 : 1, speed: type === 'fast' ? 2 : ufoSpeed });
    }

    function shootBullet() {
      if (!gameStarted || gameOver) return;
      bullets.push({ x: tank.x, y: tank.y - barrelLength - 5, dy: -6 });
      shootSound.currentTime = 0;
      shootSound.play();
    }

    function ufoShoot() {
      ufos.forEach(u => ufoBullets.push({ x: u.x, y: u.y + 10, dy: 4 }));
    }

    function update() {
      ctx.clearRect(0, 0, w, h);
      drawBackground(); drawTank();

      bullets.forEach((b, i) => {
        b.y += b.dy; drawBullet(b);
        if (b.y < 0) bullets.splice(i, 1);
      });

      ufoBullets.forEach((b, i) => {
        b.y += b.dy; drawBullet(b, 'red');
        if (collision(b, tank, 20)) {
          hp--; hitSound.currentTime = 0; hitSound.play();
          explosions.push({ x: tank.x, y: tank.y, r: 30 });
          ufoBullets.splice(i, 1);
        }
        if (b.y > h) ufoBullets.splice(i, 1);
      });

      ufos.forEach((u, i) => {
        u.x += u.dx; u.y += u.speed;
        if (u.x < 30 || u.x > w - 30) u.dx *= -1;
        drawUfo(u);
        bullets.forEach((b, j) => {
          if (collision(b, u, 30)) {
            bullets.splice(j, 1); u.hp--;
            if (u.hp <= 0) {
              explosions.push({ x: u.x, y: u.y, r: 30 });
              explosionSound.currentTime = 0; explosionSound.play();
              ufos.splice(i, 1); score++;
            }
          }
        });
        if (u.y >= h - 80) {
          explosions.push({ x: u.x, y: u.y, r: 30 });
          explosionSound.currentTime = 0; explosionSound.play();
          ufos.splice(i, 1); hp--;
        }
      });

      explosions.forEach((e, i) => {
        e.r -= 1; if (e.r <= 0) explosions.splice(i, 1); else drawExplosion(e);
      });

      drawHUD();
      if (hp <= 0) gameOver = true;
      if (!gameOver) requestAnimationFrame(update);
      else showGameOver();
    }

    function startGame(lvl) {
      document.getElementById("menu").style.display = "none";
      document.getElementById("gameover").style.display = "none";
      level = lvl; resetGameVars(); gameStarted = true;
      theme = document.getElementById("themeSelect").value;
      tankColor = document.getElementById("tankColor").value;
      barrelLength = parseInt(document.getElementById("barrelLength").value);
      if (level === 'easy') ufoSpeed = 0.5;
      else if (level === 'medium') ufoSpeed = 1;
      else if (level === 'hard') {
        ufoSpeed = 1.5;
        shootInterval = setInterval(ufoShoot, 2000);
      }
      ufoInterval = setInterval(spawnUfo, 1500);
      bgMusic.currentTime = 0;
      bgMusic.play();
      update();
    }

    function showGameOver() {
      clearInterval(ufoInterval);
      clearInterval(shootInterval);
      bgMusic.pause();
      document.getElementById("gameover").style.display = "flex";
      document.getElementById("finalScore").innerText = "Wynik: " + score;
      const best = Math.max(score, localStorage.getItem("bestScore") || 0);
      localStorage.setItem("bestScore", best);
      document.getElementById("bestScore").innerText = "Najlepszy wynik: " + best;
    }

    function restart() {
      document.getElementById("menu").style.display = "flex";
      document.getElementById("gameover").style.display = "none";
    }

    window.addEventListener("mousemove", e => tank.x = e.clientX);
    window.addEventListener("touchmove", e => { if (e.touches.length > 0) tank.x = e.touches[0].clientX; });
    window.addEventListener("click", shootBullet);
    window.addEventListener("touchstart", shootBullet);
  </script>
</body>
</html>
